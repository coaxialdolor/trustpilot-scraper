<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Results</title>
  <link rel="stylesheet" href="/static/style.css"/>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div>
        <strong>Source:</strong> {{ meta.source }}
        &nbsp;|&nbsp;
        <strong>Query:</strong> {{ meta.query }}
        &nbsp;|&nbsp;
        <strong>Total:</strong> {{ meta.count }}
        &nbsp;|&nbsp;
        <strong>Threshold:</strong> {{ meta.threshold }}
      </div>
      <form method="post" action="/export">
        <input type="hidden" name="file_path" value="{{ meta.source_path }}" />
        <input type="hidden" name="query" value="{{ meta.query }}" />
        <input type="hidden" name="threshold" value="{{ meta.threshold }}" />
        <input type="hidden" name="sort_by" value="{{ meta.sort_by }}" />
        <input type="hidden" name="model_type" value="{{ meta.model_type }}" />
        <button type="submit" class="export">Export results</button>
      </form>
    </div>

    {% for r in rows %}
      <div class="card">
        <button class="copy-btn" onclick="copyCard(this)">Copy</button>
        <div class="reviewer">{{ r.reviewer }}</div>
        <div class="date">{{ r.date }}</div>
        <div class="score">Match score: {{ '%.3f'|format(r.score) if r.score is not none else '' }}</div>
        <div class="link"><a href="{{ r.link }}" target="_blank">{{ r.link }}</a></div>
        <div class="text">{{ r.text }}</div>
      </div>
    {% endfor %}
  </div>
  <script>
    function copyCard(btn){
      const card = btn.closest('.card');
      if(!card) return;
      const reviewer = card.querySelector('.reviewer')?.textContent?.trim() || '';
      const date = card.querySelector('.date')?.textContent?.trim() || '';
      const score = card.querySelector('.score')?.textContent?.trim() || '';
      const link = card.querySelector('.link a')?.getAttribute('href') || '';
      const text = card.querySelector('.text')?.textContent?.trim() || '';
      const blob = `Reviewer: ${reviewer}\nDate: ${date}\n${score}\nLink: ${link}\n\n${text}`;
      navigator.clipboard.writeText(blob).then(()=>{
        btn.textContent = 'Copied!';
        setTimeout(()=>{ btn.textContent = 'Copy'; }, 1200);
      }).catch(()=>{
        btn.textContent = 'Copy failed';
        setTimeout(()=>{ btn.textContent = 'Copy'; }, 1200);
      });
    }
  </script>
</body>
</html>


